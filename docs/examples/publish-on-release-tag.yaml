---

# This GitHub Actions workflow is designed to be triggered on a push to the main branch with a tag that starts with 'v' (e.g., v1.0.0). The workflow performs the following tasks:

# Extract Release Version: Extracts the tag name and removes the leading 'v' character to get the release version.
# Update pom.xml: Updates the version in the pom.xml file using the extracted release version.
# Publish to Maven: Publishes the artifact to the Maven repository using the updated pom.xml.

name: Publish on release tag

on:
  push:
    tags:
      - 'v*.*.*'
    branches:
      - main

jobs:
  get_release_version:
    runs-on: ubuntu-latest
    outputs:
      release_version: ${{ steps.get_release_version.outputs.release_version }}
    steps:
      - name: Get release version
        id: get_release_version
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          RELEASE_VERSION=${TAG_NAME#v}
          echo "::set-output name=release_version::$RELEASE_VERSION"

  pom:
    uses: Netcracker/qubership-workflow-hub/.github/workflows/update-pom-release.yml@main
    with:
      file: pom.xml
      revision: ${{ steps.get_release_version.outputs.release_version }}

  maven:
    uses: Netcracker/qubership-workflow-hub/.github/workflows/maven-publish.yml@main
    needs: pom
    with:
      maven_command: "--batch-mode deploy"
      java_version: '21'
      revision: ${{ steps.get_release_version.outputs.release_version }}
    secrets:
      maven_username: ${{ secrets.MAVEN_USER }}
      maven_password: ${{ secrets.MAVEN_PASSWORD }}
      maven_gpg_passphrase: ${{ secrets.MAVEN_GPG_PASSPHRASE }}
      maven_gpg_private_key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }}
